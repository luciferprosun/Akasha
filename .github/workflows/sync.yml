import os
import requests
from datetime import datetime

# =======================
# KONFIGURACJA
# =======================

FB_TOKEN = os.getenv("FB_PAGE_ACCESS_TOKEN")  # GitHub Secret
PAGE_ID = "156505540370768"
API_VERSION = "v18.0"
OUTPUT_FILE = "POSTY_FACEBOOK.md"

if not FB_TOKEN:
    raise RuntimeError("‚ùå Brak FB_PAGE_ACCESS_TOKEN w GitHub Secrets")

# =======================
# POBIERANIE POST√ìW (Z PAGINACJƒÑ)
# =======================

def fetch_fb_posts():
    url = f"https://graph.facebook.com/{API_VERSION}/{PAGE_ID}/feed"
    params = {
        "access_token": FB_TOKEN,
        "fields": "id,message,created_time,permalink_url"
    }

    posts = []

    while url:
        response = requests.get(url, params=params, timeout=10)
        response.raise_for_status()
        data = response.json()

        posts.extend(data.get("data", []))
        url = data.get("paging", {}).get("next")
        params = None  # kolejne requesty u≈ºywajƒÖ pe≈Çnego URL

    return posts

# =======================
# ZAPIS DO MARKDOWN
# =======================

def save_posts(posts):
    with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
        f.write("# üìò Archiwum post√≥w ‚Äì Akasha Chronicles\n\n")
        f.write(f"Ostatnia synchronizacja: {datetime.now():%Y-%m-%d %H:%M:%S}\n\n")
        f.write("---\n\n")

        for post in reversed(posts):  # od najstarszych
            created = datetime.fromisoformat(
                post["created_time"].replace
